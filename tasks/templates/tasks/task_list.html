{% extends "base.html" %}
{% block title %}Tasks{% endblock %}
{% block content %}

    <form method="get" style="display:flex;gap:.5rem;margin-bottom:1rem">
        <input name="q" value="{{ request.GET.q }}" placeholder="Search title..."/>
        <button type="submit">Filter</button>
        {% if request.GET.q %}<a class="button" href="{% url 'tasks:list' %}">Clear</a>{% endif %}
    </form>

    <ul>
        {% for task in object_list %}
            <li class="{% if task.is_done %}done{% endif %}">
                {{ task.title }}

                <form class="inline" action="{% url 'tasks:toggle' task.id %}" method="post">
                    {% csrf_token %}
                    <button>{% if task.is_done %}Mark Open{% else %}Mark Done{% endif %}</button>
                </form>

                <a class="button" href="{% url 'tasks:update' task.id %}">Edit</a>
                <a class="button" href="{% url 'tasks:delete' task.id %}">Delete</a>
            </li>
        {% empty %}
            <li>No tasks yet.</li>
        {% endfor %}
    </ul>

    {% if is_paginated %}
        <nav style="display:flex;gap:.5rem;align-items:center">
            {% if page_obj.has_previous %}
                <a class="button" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Prev</a>
            {% endif %}
            <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a class="button"
                   href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Next</a>
            {% endif %}
        </nav>
    {% endif %}
{% endblock %}
